checks:
  php: true

filter:
  paths:
    - 'src/'
  dependency_paths:
    - 'vendor/'

build:
  environment:
    php:
      version: '7.2'
      ini:
        'always_populate_raw_post_data': '-1'

  dependencies:
    before:
      - sed -i 's/zend_extension_ts=xdebug.so/;zend_extension_ts=xdebug.so/' ~/.phpenv/versions/$(phpenv global)/etc/php.ini
      - composer global require "hirak/prestissimo:^0.3"

    override:
      - { command: 'composer install --no-interaction --no-progress --no-suggest', idle_timeout: 600 }

  tests:
    override:
      - true

  nodes:
    analysis:
      project_setup:
        override:
          - bin/magento setup:di:compile

  cache:
    directories:
      - '~/.composer/cache'
      - 'vendor'
      - 'bin'
      - 'app/etc/db_schema.xml'
      - 'app/etc/di.xml'
      - 'app/etc/NonComposerComponentRegistration.php'
      - 'app/etc/registration_globlist.php'
      - 'app/etc/vendor_path.php'
      - 'app/autoload.php'
      - 'app/bootstrap.php'
      - 'app/functions.php'
      - 'setup'

build_failure_conditions:
  - 'elements.rating(< A).new.exists'
  - 'issues.label("coding-style").new.exists'
  - 'issues.new.exists'
  - 'project.metric("scrutinizer.quality", < 9.00)'
