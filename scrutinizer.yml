build:
  environment:
    php:
      version: '7.2'

  nodes:
    analysis:
      tests:
        override:
          - php-scrutinizer-run
          - bin/phpcs -p
          - bin/phpstan analyse
          - bin/psalm
          - bin/phpmd ./src text ./phpmd.xml
          - bin/behat --no-interaction --no-snippets --stop-on-failure --format=pretty
          - bin/phpspec run

      dependencies:
        override:
          - { command: 'composer install --no-interaction', idle_timeout: 600 }

  cache:
    directories: [ vendor/, bin/, ~/.composer/cache ]

filter:
  paths:
    - 'src/*'
  excluded_paths:
    - 'features/bootstrap/*'
    - 'dev/*'
    - 'var/*'
    - 'lib/*'
    - 'bin/*'
    - 'vendor/*'

build_failure_conditions:
  - 'elements.rating(< A).new.exists'
  - 'issues.label("coding-style").new.exists'
  - 'issues.new.exists'
  - 'project.metric("scrutinizer.quality", < 9.00)'
